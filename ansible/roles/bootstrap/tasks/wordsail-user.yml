---
- name: Create sudo group
  ansible.builtin.group:
    name: sudo
    state: present

- name: Configure sudoers
  ansible.builtin.lineinfile:
    path: /etc/sudoers
    regexp: "^%sudo"
    line: "%sudo ALL=(ALL:ALL) ALL"
    validate: /usr/sbin/visudo -cf %s

- name: Create wordsail user
  ansible.builtin.user:
    name: wordsail
    groups: sudo
    shell: /bin/bash
    create_home: true
    state: present

- name: Set up authorized key for wordsail
  ansible.posix.authorized_key:
    user: wordsail
    key: "{{ lookup('file', wordsail_ssh_key) if wordsail_ssh_key is match('.*\\.(pub|pem)$') or wordsail_ssh_key.startswith('~') or wordsail_ssh_key.startswith('/') else wordsail_ssh_key }}"
    state: present
    manage_dir: true

- name: Configure sudoers for wordsail
  ansible.builtin.copy:
    dest: /etc/sudoers.d/00-wordsail
    content: "wordsail ALL=(ALL) NOPASSWD: ALL"
    mode: "0440"
    validate: /usr/sbin/visudo -cf %s
