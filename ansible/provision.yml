---
- name: Configure WordPress Hosting Server
  hosts: all:!localhost
  become: true
  gather_facts: true
  pre_tasks:
    - name: Validate required variables
      ansible.builtin.assert:
        that:
          - certbot_email is defined and certbot_email | length > 0
          - mysql_wordsailbot_password is defined and mysql_wordsailbot_password | length > 0
          - wordsail_ssh_key is defined and wordsail_ssh_key | length > 0
        fail_msg: |
          Required variables are missing or empty. Please set:
            - certbot_email: Email for Let's Encrypt certificates
            - mysql_wordsailbot_password: MySQL admin password
            - wordsail_ssh_key: SSH public key for wordsail user
          Set these in group_vars/all.yml or pass via --extra-vars
  roles:
    - { role: bootstrap, tags: "bootstrap" }
    - { role: database, tags: "database" }
    - { role: nginx, tags: "nginx" }
    - { role: php, tags: "php" }
    - { role: security, tags: "security" }
